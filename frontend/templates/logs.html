{% extends "base.html" %}

{% block title %}Logs - BugSeek{% endblock %}

{% block content %}
<h2>📋 Error Logs</h2>

<div class="card">
    <form method="GET" style="display: flex; gap: 1rem; align-items: end;">
        <div class="form-group" style="margin: 0; flex: 1;">
            <label for="search">Search</label>
            <input type="text" id="search" name="search" class="form-control" 
                   placeholder="Search logs..." value="{{ search }}">
        </div>
        <div class="form-group" style="margin: 0; flex: 1;">
            <label for="team">Team Filter</label>
            <input type="text" id="team" name="team" class="form-control" 
                   placeholder="Filter by team..." value="{{ team_filter }}">
        </div>
        <button type="submit" class="btn">🔍 Filter</button>
        <a href="/logs" class="btn">Clear</a>
    </form>
</div>

{% if logs %}
<div class="card">
    <table class="table">
        <thead>
            <tr>
                <th>Team</th>
                <th>Module</th>
                <th>Owner</th>
                <th>Status</th>
                <th>Created</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for log in logs %}
            <tr>
                <td>{{ log.TeamName }}</td>
                <td>{{ log.Module }}</td>
                <td>{{ log.Owner }}</td>
                <td>
                    {% if log.SolutionPossible %}
                        <span class="status-badge status-success">✅ Solution Available</span>
                    {% else %}
                        <span class="status-badge status-danger">❌ No Solution</span>
                    {% endif %}
                </td>
                <td>{{ log.CreatedAt[:10] if log.CreatedAt else 'N/A' }}</td>
                <td>
                    <a href="/report/{{ log.Cr_ID }}" class="btn" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;">View Report</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if pagination.total_pages > 1 %}
<div class="pagination">
    {% if pagination.page > 1 %}
        <a href="?page={{ pagination.page - 1 }}{% if search %}&search={{ search }}{% endif %}{% if team_filter %}&team={{ team_filter }}{% endif %}">« Previous</a>
    {% endif %}
    
    {% for page_num in range(1, pagination.total_pages + 1) %}
        {% if page_num == pagination.page %}
            <span style="padding: 0.5rem 1rem; margin: 0 0.25rem; background: #6c757d; color: white; border-radius: 4px;">{{ page_num }}</span>
        {% elif page_num <= 3 or page_num > pagination.total_pages - 3 or (page_num >= pagination.page - 1 and page_num <= pagination.page + 1) %}
            <a href="?page={{ page_num }}{% if search %}&search={{ search }}{% endif %}{% if team_filter %}&team={{ team_filter }}{% endif %}">{{ page_num }}</a>
        {% elif page_num == 4 or page_num == pagination.total_pages - 3 %}
            <span style="padding: 0.5rem 1rem; margin: 0 0.25rem;">...</span>
        {% endif %}
    {% endfor %}
    
    {% if pagination.page < pagination.total_pages %}
        <a href="?page={{ pagination.page + 1 }}{% if search %}&search={{ search }}{% endif %}{% if team_filter %}&team={{ team_filter }}{% endif %}">Next »</a>
    {% endif %}
</div>
{% endif %}

{% else %}
<div class="card">
    <div style="text-align: center; padding: 2rem; color: #666;">
        <h3>📄 No logs found</h3>
        <p>{% if search or team_filter %}Try adjusting your search filters.{% else %}Upload your first error log to get started!{% endif %}</p>
        <br>
        <a href="/upload" class="btn btn-success">Upload New Log</a>
    </div>
</div>
{% endif %}

<div class="card">
    <h3>📊 Summary</h3>
    <p>
        {% if logs %}
            Showing {{ logs|length }} log(s) 
            {% if pagination.total_items > logs|length %}
                of {{ pagination.total_items }} total
            {% endif %}
        {% else %}
            No logs to display
        {% endif %}
    </p>
</div>
{% endblock %}
